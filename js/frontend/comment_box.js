"use restrict";$('document').ready(function () {    $('#form_comment').on('submit', function (e) {        e.preventDefault();        var _this = $(this);        var data = {            article_id: _this.find('.article_id').val(),            user_avatar: _this.find('.user_avatar').val(),            comment_text: $.trim(_this.find('.comment_text').val()),            username: $('#real_user_name').val(),            user_full_name: $('#real_user_full_name').val(),            user_id: $('#real_user_id').val()        };        if (data.comment_text == '') {            return false;        } else if (filter_string(data.comment_text)) {            $('#badComment').modal('show');        } else {            $.ajax({                url:  SiteData.baseURL + '/comment/addComment',                type: 'POST',                data: data,                dataType: 'json',                success: function (resp) {                    var comment = $(comment_template);                    comment.find('.time').html(Bcore.i18n('just_now'));                    comment.find('.comment_text').html(data.comment_text);                    comment.find('.user').html(data.user_full_name);                    comment.find('.owner_cmt').val(data.user_id);                    comment.find('.comment_id').val(resp.comment_id.uuid);                    comment.find('.user_avatar').attr('src', 'https://graph.facebook.com/' + data.user_avatar + '/picture?width=35&amp;height=35');                    _this.parent().find('.comment_row').prepend(comment.hide().fadeIn('slow'));                }            });            _this.find('.comment_text').val('');            return false;        }    });});function add_reply(obj) {    var _this = obj;    var data = {        article_id: _this.parents('div.post-footer').find('.article_id').val(),        //reply_text: _this.find('.reply_text').val(),        comment_id: _this.parents('li.element_cmt').find('.comment_id').val(),        parent_id: _this.parents('li.element_cmt').find('.comment_id').val(),        username: $('#real_user_name').val(),        user_full_name: $('#real_user_full_name').val(),        user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()    };    if (_this.parents('li.element_cmt').find('.form_reply').length > 0) {        _this.parents('li.element_cmt').find('.form_reply').remove().fadeOut('slow');    }    else {        _this.parents('li.element_cmt').find('.form_edit_cmt').remove();        var comment_id = _this.parents('li.comment').find('.comment_id').val();        var article_id = _this.parents('div.post-footer').find('.article_id').val();        var formReply = $(form_reply);        _this.parents('li.element_cmt').find('div.comment_heading').append(formReply);    }    if (_this.parents('li.element_cmt').find('li.element_reply').length > 0) {        return;    } else {        list_rep = [];        months = ["January","February","March","April","May","June","July","August","September","October","November","December"];        $.ajax({            type: 'POST',            url:  SiteData.baseURL + '/comment/viewReplyByComment',            data: data,            dataType: 'json',            success: function (data) {                data.forEach(function(row) {                    var fullDay = timestamp_to_str(row.datetime_reply);                    replies = $(reply_list);                    replies.find('.user_reply').html(row.user_full_name);                    replies.find('.user_time').html(fullDay);                    replies.find('.user_avatar').attr('src', 'https://graph.facebook.com/' + row.user_avatar + '/picture?width=35&amp;height=35');                    replies.find('.reply_text').html(row.reply_text);                    replies.find('.reply_id').val(row.reply_id);                    replies.find('.owner_rep').val(row.user_id);                    list_rep.push(replies);                });                _this.parents('li.element_cmt').find('.reply_list').prepend(list_rep);            }        });    }}function textAreaAdjust(o) {    var _this = o;    var offset = _this.offsetHeight - _this.clientHeight;    var resizeTextarea = function(el) {        jQuery(el).css('height', 'auto').css('height', el.scrollHeight + offset);    };    jQuery(_this).on('keyup input', function() { resizeTextarea(_this); }).removeAttr('data-autoresize');}function reply_form(form) {    var _this = form;    var data = {        article_id: _this.parents('div.post-footer').find('.article_id').val(),        reply_text: $.trim(_this.find('.reply_text').val()),        comment_id: _this.parents('div.comment-body').find('.comment_id').val(),        parent_id: _this.parents('div.comment-body').find('.comment_id').val(),        username: $('#real_user_name').val(),        user_full_name: $('#real_user_full_name').val(),        user_id: $('#real_user_id').val(),        user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()    };    if (data.reply_text == '') {        return false;    } else {        $.ajax({            url: SiteData.baseURL + '/comment/reply',            type: 'POST',            data: data,            dataType: 'json',            success: function (resp) {                reply = $(reply_list);                reply.find('.user_reply').html(data.user_full_name);                reply.find('.user_time').html(Bcore.i18n('just_now'));                reply.find('.reply_text').html(data.reply_text);                reply.find('.owner_rep').val(data.user_id);                reply.find('.reply_id').val(resp.reply_id.uuid);                reply.find('.user_avatar').attr('src', 'https://graph.facebook.com/' + data.user_avatar + '/picture?width=35&amp;height=35');                _this.parents('li.element_cmt').find('.reply_list').prepend(reply.hide().fadeIn('slow'));            },            error: function () {                $('#notAllowModal').modal('show');            }        });        _this.find('.reply_text').val('');        return false;    }}function edit_cmt_form(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0 || _this.parents('li.element_cmt').find('.owner_cmt').val() != $('#real_user_id').val()) {        $('#notAllowModal').modal('show');    } else {        comment_text = _this.parents('li.element_cmt').find('.comment_text').html();        comment_id = _this.parents('li.element_cmt').find('.comment_id').val();        var edit_comment = $(edit_comment_template);        if (_this.parents('li.element_cmt').find('.form_reply').length > 0) {            _this.parents('li.element_cmt').find('.form_reply').remove()        }        if (_this.parents('li.element_cmt').find('.form_edit_cmt').length > 0) {            _this.parents('li.element_cmt').find('.form_edit_cmt').remove().fadeOut('slow');        } else {            edit_comment.find('.edit_comment_text').val(comment_text);            edit_comment.find('.comment_id').val(comment_id);            _this.parents('li.element_cmt').find('div.comment_heading').append(edit_comment);        }    }}function editComment(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0) {        $('#notAllowModal').modal('show');    } else {        var data = {            article_id: _this.parents('div.post-footer').find('.article_id').val(),            comment_id: _this.parents('li.element_cmt').find('.comment_id').val(),            comment_text: $.trim(_this.find('.edit_comment_text').val()),            username: $('#real_user_name').val(),            user_full_name: $('#real_user_full_name').val(),            user_id: $('#real_user_id').val(),            owner_cmt: _this.parents('li.element_cmt').find('.owner_cmt').val(),            user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()        };        if (data.comment_text == '') {            return false;        } else {            $.ajax({                type: 'POST',                url: SiteData.baseURL + '/comment/editComment',                data: data,                dataType: 'json',                success: function () {                    _this.parents('li.element_cmt').find('.comment_text').html(data.comment_text);                    _this.parents('li.element_cmt').find('.form_edit_cmt').remove();                },                error: function () {                    $('#notAllowModal').modal('show');                    _this.parents('li.element_cmt').find('.form_edit_cmt').remove();                }            });            return false;        }    }}function cmt_del(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0 || _this.parents('li.element_cmt').find('.owner_cmt').val() != $('#real_user_id').val()) {        $('#notAllowModal').modal('show');    } else {        var data = {            article_id: _this.parents('div.post-footer').find('.article_id').val(),            user_id: $('#real_user_id').val(),            user_full_name: $('#real_user_full_name').val(),            comment_id: _this.parents('li.element_cmt').find('.comment_id').val(),            comment_text: _this.parents('li.element_cmt').find('.comment_text').html(),            owner_cmt: _this.parents('li.element_cmt').find('.owner_cmt').val(),            user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()        };        $.ajax({            url: SiteData.baseURL + '/comment/deleteComment',            type: 'POST',            data: data,            dataType: 'json',            success: function () {                _this.parents('li.comment').remove();            },            error: function () {                $('#notAllowModal').modal('show');            }        });    }}function like_cmt(obj) {    if ( $('#real_user_id').val() == 0) {        $('#loginModal').modal('show');    } else {        var _this = obj;        var data = {            article_id: _this.parents('div.post-footer').find('.article_id').val(),            user_id: $('#real_user_id').val(),            user_name: $('#real_user_name').val(),            user_full_name: $('#real_user_full_name').val(),            comment_id: _this.parents('li.element_cmt').find('.comment_id').val(),            owner: _this.parents('li.element_cmt').find('.owner_cmt').val()        };        var like_number = parseInt(_this.find('span').html());        console.log(data, like_number);        $.ajax({            url: SiteData.baseURL + '/comment/like',            type: 'POST',            data: data,            dataType: 'json',            success: function () {                _this.find('span').html(like_number + 1);            },            error: function () {                _this.find('span').html(like_number - 1);            }        });    }}function edit_reply_form(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0 || _this.parents('li.element_cmt').find('.owner_rep').val() != $('#real_user_id').val()) {        $('#notAllowModal').modal('show');    } else {        reply_text = _this.parents('li.element_reply').find('.reply_text').html();        reply_id = _this.parents('li.element_reply').find('.reply_id').val();        var edit_reply = $(edit_reply_template);        if (_this.parents('li.element_reply').find('.form_reply').length > 0) {            _this.parents('li.element_reply').find('.form_reply').remove()        }        if (_this.parents('li.element_reply').find('.form_edit_reply').length > 0) {            _this.parents('li.element_reply').find('.form_edit_reply').remove().fadeOut('slow');        } else {            edit_reply.find('.edit_reply_text').val(reply_text);            edit_reply.find('.reply_id').val(reply_id);            _this.parents('li.element_reply').find('div.reply_body').append(edit_reply);        }    }}function editReply(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0 || _this.parents('li.element_cmt').find('.owner_rep').val() != $('#real_user_id').val()) {        $('#notAllowModal').modal('show');    } else {        var data = {            article_id: _this.parents('div.post-footer').find('.article_id').val(),            reply_id: _this.parents('li.element_reply').find('.reply_id').val(),            owner_rep: _this.parents('li.element_reply').find('.owner_rep').val(),            parent_id: _this.parents('li.element_cmt').find('.comment_id').val(),            reply_text: $.trim(_this.find('.edit_reply_text').val()),            username: $('#real_user_name').val(),            user_full_name: $('#real_user_full_name').val(),            user_id: $('#real_user_id').val(),            user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()        };        if (data.reply_text == '') {            return false;        } else {            $.ajax({                type: 'POST',                url: SiteData.baseURL + '/comment/editReply',                data: data,                dataType: 'json',                success: function () {                    _this.parents('li.element_reply').find('.reply_text').html(data.reply_text);                    _this.parents('li.element_reply').find('.form_edit_reply').remove();                },                error: function () {                    $('#notAllowModal').modal('show');                    _this.parents('li.element_reply').find('.form_edit_reply').remove();                }            });            return false;        }    }}function reply_del(obj) {    var _this = obj;    if ( $('#real_user_id').val() == 0 || _this.parents('li.element_cmt').find('.owner_rep').val() != $('#real_user_id').val()) {        $('#notAllowModal').modal('show');    } else {        var data = {            article_id: _this.parents('div.post-footer').find('.article_id').val(),            user_id: $('#real_user_id').val(),            user_name: $('#real_user_name').val(),            user_full_name: $('#real_user_full_name').val(),            reply_id: _this.parents('li.element_reply').find('.reply_id').val(),            owner_rep: _this.parents('li.element_reply').find('.owner_rep').val(),            reply_text: _this.parents('li.element_reply').find('.reply_text').val(),            comment_id: _this.parents('li.element_cmt').find('.comment_id').val(),            user_avatar: _this.parents('div.post-footer').find('.user_avatar').val()        };        $.ajax({            url: SiteData.baseURL + '/comment/deleteReply',            type: 'POST',            data: data,            dataType: 'json',            success: function () {                _this.parents('li.element_reply').remove();            },            error: function () {                $('#notAllowModal').modal('show');            }        });    }}// Display a list comment by articlefunction view_comment(obj) {    var _this = obj;    var data = {        article_id: _this.parents('.post-footer').find('.article_id').val()    };    list_cmt = [];    $.ajax({        type: 'POST',        url: SiteData.baseURL + '/comment/viewCommentByArticle',        data: data,        dataType: 'json',        success: function (data) {            data.forEach(function(row) {                var fullDay = timestamp_to_str(row.datetime_cmt);                view_comment_temp = $(view_comment_template);                view_comment_temp.find('.user_avatar').attr('src', 'https://graph.facebook.com/' + row.user_avatar + '/picture?width=35&amp;height=35');                view_comment_temp.find('.user_comment').html(row.user_full_name);                view_comment_temp.find('.user_time').html(fullDay);                view_comment_temp.find('.comment_id').val(row.comment_id);                view_comment_temp.find('.user_id').val(row.user_id);                view_comment_temp.find('.owner_cmt').val(row.user_id);                view_comment_temp.find('.like_number').html(row.checkLike);                view_comment_temp.find('.comment_text').html(row.comment_text);                list_cmt.push(view_comment_temp);            });            _this.parents('ul.comment_row').prepend(list_cmt);            _this.parents('.post-footer').find('#view_comment').remove();        }    });}var comment_template = '<li class="comment element_cmt">\n    <a class="pull-left" href="javascript:;">\n        <img width="35" class="user_avatar">\n    </a>\n    <div class="pull-right">\n        <a href="javascript:;" class="btn btn-default btn-xs like_number"\n           onclick="like_cmt($(this))">\n            <i class="fa fa-thumbs-up"></i> <span>0</span>\n        </a>\n        <a href="javascript:;" class="btn btn-default btn-xs" onclick="add_reply($(this))">\n            <i class="fa fa-reply"></i>' + Bcore.i18n('reply') +'\n        </a>\n        <div class="portlet-widgets btn-group dropdown">\n            <button type="button" class="btn btn-default btn-xs" data-toggle="dropdown">\n                <i class="fa fa-cog"></i> ' + Bcore.i18n('option') +'\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu" role="menu">\n                <li><a href="javascript:;" class="comment_edit" onclick="edit_cmt_form($(this))"><i\n                        class="fa fa-edit"></i>  ' + Bcore.i18n('edit') +'</a>\n                </li>\n                <li><a href="javascript:;" class="comment_delete" onclick="cmt_del($(this))"><i\n                        class="fa fa-times"></i> ' + Bcore.i18n('delete') +'</a>\n                </li>\n            </ul>\n        </div>\n        <span class="divider"></span>\n    </div>\n    <div class="comment-body comment_heading">\n        <div class="comment-heading">\n            <h4 class="user">Lamvh</h4>\n            <h5 class="time"></h5>\n        </div>\n        <input type="hidden" name="comment_id" value="" class="comment_id">\n        <input type="hidden" name="owner_cmt" value="" class="owner_cmt">\n        <p class="comment_text comment_emoticons"></p>\n        <ul class="comment-list reply_list">\n\n        </ul>\n    </div>\n</li>';var form_reply = '<form onsubmit="return reply_form($(this))" method="post" class="form_reply">\n    <div class="input-group">\n        <textarea onkeyup="textAreaAdjust(this)" class="form-control reply_text" name="reply_text"\n                  id="reply_text"\n                  placeholder="'+ Bcore.i18n('add_reply') +'"\n                  type="text" rows="1"></textarea>\n        <span class="input-group-addon">\n            <button class="share_button" id="share_reply_button">\n                <a href="javascript:;">\n                    <i class="fa fa-reply"></i></a>\n            </button>\n        </span>\n    </div>\n</form>';var reply_list = '<li class="comment element_reply">\n    <a class="pull-left" href="#">\n        <img width="35" class="user_avatar reply_avatar">\n    </a>\n    <div class="pull-right">\n        <div class="portlet-widgets btn-group dropdown">\n            <button type="button" class="btn btn-default btn-xs" data-toggle="dropdown">\n                <i class="fa fa-cog"></i> ' + Bcore.i18n('option') +'\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu" role="menu">\n                <li><a href="javascript:;" class="comment_edit" onclick="edit_reply_form($(this))"><i\n                        class="fa fa-edit"></i> ' + Bcore.i18n('edit') +'</a>\n                </li>\n                <li><a href="javascript:;" class="comment_delete" onclick="reply_del($(this))"><i\n                        class="fa fa-times"></i> ' + Bcore.i18n('delete') +'</a>\n                </li>\n            </ul>\n        </div>\n        <span class="divider"></span>\n    </div>\n    <div class="comment-body reply_body">\n        <div class="comment-heading">\n            <h4 class="user user_reply">Ryan Haywood</h4>\n            <h5 class="time user_time">3 minutes ago</h5>\n        </div>\n        <input type="hidden" name="reply_id" value="" class="reply_id">\n        <input type="hidden" name="owner_rep" value="" class="owner_rep">\n        <p class="reply_text comment_emoticons">Relax my friend</p>\n    </div>\n</li>';var edit_comment_template = '<form onsubmit="return editComment($(this))" method="post" class="form_edit_cmt">\n    <div class="input-group">\n        <input type="hidden" class="comment_id" value="">\n        <textarea onkeyup="textAreaAdjust(this)" class="form-control edit_comment_text" name="edit_comment_text"\n                  id="edit_comment_text"\n                  placeholder="' + Bcore.i18n('edit_comment') +'"\n                  type="text" rows="1"></textarea>\n        <span class="input-group-addon">\n            <button class="share_button">\n                <a href="javascript:;"><i class="fa fa-edit"></i></a>\n            </button>\n        </span>\n    </div>\n</form>';var edit_reply_template = '<form onsubmit="return editReply($(this))" method="post" class="form_edit_reply">\n    <div class="input-group">\n        <input type="hidden" class="reply_id" value="">\n        <textarea onkeyup="textAreaAdjust(this)" class="form-control edit_reply_text" name="edit_reply_text"\n                  id="edit_reply_text"\n                  placeholder="' + Bcore.i18n('edit_reply') +'"\n                  type="text" rows="1"></textarea>\n        <span class="input-group-addon">\n            <button class="share_button">\n                <a href="javascript:;"><i class="fa fa-edit"></i></a>\n            </button>\n        </span>\n    </div>\n</form>';var view_comment_template = '<li class="comment element_cmt">\n    <a class="pull-left" href="javascript:;">\n        <img src="" width="35" class="user_avatar">\n    </a>\n    <div class="pull-right">\n        <a href="javascript:;" class="btn btn-default btn-xs"\n           onclick="like_cmt($(this))">\n            <i class="fa fa-thumbs-up"></i>\n            <span class="like_number">0</span>\n        </a>\n        <a href="javascript:;" class="btn btn-default btn-xs reply_button"\n           onclick="add_reply($(this))">\n            <i class="fa fa-reply"></i> ' + Bcore.i18n('reply') +'\n        </a>\n        <div class="portlet-widgets btn-group dropdown">\n            <button type="button" class="btn btn-default btn-xs option_button"\n                    data-toggle="dropdown">\n                <i class="fa fa-cog"></i> '+ Bcore.i18n('option') +'\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu" role="menu">\n                <li><a href="javascript:;"\n                       onclick="edit_cmt_form($(this))"><i\n                        class="fa fa-edit"></i> ' + Bcore.i18n('edit') + '</a>\n                </li>\n                <li><a href="javascript:;" \n                       onclick="cmt_del($(this))"><i\n                        class="fa fa-times"></i> '+ Bcore.i18n('delete') + '</a>\n                </li>\n            </ul>\n        </div>\n        <span class="divider"></span>\n    </div>\n    <div class="comment-body comment_heading">\n        <div class="comment-heading">\n            <h4 class="user user_comment">user_full_name</h4>\n            <h5 class="time user_time">user_time</h5>\n        </div>\n        <input type="hidden" value="" class="comment_id" name="comment_id">\n        <input type="hidden" value="" class="owner_cmt" name="owner_cmt">\n        <p class="comment_text comment_emoticons">comment_text</p>\n        \n        <ul class="comment-list reply_list ">\n            \n        </ul>\n    </div>\n\n    \n</li>';var bad_words_array= ['dkm', 'fuck'];function timestamp_to_str(time_stamp) {    distanceSeconds = Math.round(Math.abs(Math.round(new Date().getTime() / 1000) - time_stamp));    distanceMinutes = Math.round(distanceSeconds / 60);    if (distanceMinutes <= 1) {        return Bcore.i18n('time_current');    }    if (distanceMinutes <= 2) {        return Bcore.i18n('time_distance_in_minute');    }    if (distanceMinutes < 45) {        return Bcore.i18n('$1 time_distance_in_minutes', distanceMinutes);    }    if (distanceMinutes < 90) {        return Bcore.i18n('time_distance_in_hour');    }    if (distanceMinutes < 1440) {        return Bcore.i18n('$1 time_distance_in_hours', Math.round(parseFloat(distanceMinutes) / 60.0));    }    if (distanceMinutes < 2880) {        return Bcore.i18n('time_distance_in_day');    }    if (distanceMinutes < 43200) {        return Bcore.i18n('$1 time_distance_in_days', Math.round(parseFloat(distanceMinutes) / 1440));    }    if (distanceMinutes < 86400) {        return Bcore.i18n('$1 time_distance_in_month');    }    if (distanceMinutes < 525600) {        return Bcore.i18n('$1 time_distance_in_months', Math.round(parseFloat(distanceMinutes) / 43200));    }    if (distanceMinutes < 1051199) {        return Bcore.i18n('time_distance_in_year');    }    return Bcore.i18n('$1 time_distance_in_year_over', Math.round(parseFloat(distanceMinutes) / 525600));}function filter_string(_str) {    var alert_count = 0;    var compare_text = _str;    for (var i = 0; i < bad_words_array.length; i++) {        for (var j = 0; j < (compare_text.length); j++) {            if (bad_words_array[i] == compare_text.substring(j, (j + bad_words_array[i].length)).toLowerCase()) {                alert_count++;            }        }    }    return alert_count;}